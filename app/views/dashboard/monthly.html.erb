<%= render partial: 'shared/header', locals: { title: 'Monthly', subtitle: 'Monthly reports' } %>
<%= render partial: 'shared/date_filter', locals: {startdate: @startdate, enddate: @enddate} %>

<section class="section chart">
  <h1 class="title">
    Per Month
  </h1>
  <h2 class="subtitle">
    Income
  </h2>
  <%= column_chart @income_per_month %>
  <h2 class="subtitle">
    Income by merchant
  </h2>
  <%= line_chart @income_per_month_by_merchant %>
  <h2 class="subtitle">
    Spending
  </h2>
  <%= column_chart @spend_per_month %>
  <h2 class="subtitle">
    Spend per category
  </h2>
  <%= line_chart @spending_by_category_per_month %>

  <h2 class="subtitle">
    Spend per category
  </h2>
  <table class="table is-fullwidth">
    <thead>
      <tr>
        <th><abbr title="Category">Category</abbr></th>
        <%- @spending_by_category_per_month[0][:data].keys.each do |value| %>
          <th><abbr title="<%= value %>"><%= value %></abbr></th>
        <%- end %>
        <th><abbr title="Mean">Mean</abbr></th>
      </tr>
    </thead>
    <tbody>
      <%- @spending_by_category_per_month.each do |s| %>
      <tr>
        <td>
          <%= s[:name] %>
        </td>
        <%- s[:data].values.each do |value| %>
          <td>
            <%= Money.from_cents(value * 100).format %>
          </td>
        <%- end %>
        <td>
          <%= Money.from_cents(s[:data].values.inject(&:+) / s[:data].values.size * 100).format %>
        </td>
      </tr>
      <%- end %>
    </tbody>
  </table>

  <h2 class="subtitle">
    Income and spending
  </h2>
  <%= line_chart @income_and_spending %>
  <h2 class="subtitle">
    Net
  </h2>
  <%= column_chart @net_per_month %>
  <h2 class="subtitle">
    Balance
  </h2>
  <%= line_chart @balances %>
</section>
